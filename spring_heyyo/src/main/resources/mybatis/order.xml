<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="orders"> 
	<insert id="create" parameterType="OrdersDTO">
		insert into orders(order_num, o_pay, o_req, o_address, r_code, m_id ,
		o_mileage)
		values(#{order_num},#{o_pay},#{o_req},#{o_address},#{r_code},#{m_id},#{o_mileage})
	</insert>
	<select id="read" parameterType="int" resultType="OrdersDTO">
		select order_num, o_pay, o_req, o_address,r_code from orders where order_num
		= #{order_num}
	</select>
	<delete id="delete" parameterType="int">
		delete from orders
		where order_num = #{order_num}
	</delete>
	<delete id="deleteAll" parameterType="String">
		delete from member
		where m_id = #{m_id}
	</delete>
	<select id="list" parameterType="String" resultType="OrdersDTO">
		select * from Orders where m_id = #{param.m_id, jdbcType=VARCHAR}
	</select>

	<update id="update" parameterType="Map">
		update member set m_mileage = m_mileage - #{o_mileage} +
		(select mileage from mileage_info where member.m_grade =
		mileage_info.m_grade), m_ordercnt = m_ordercnt+1
		where m_id = #{m_id}
	</update>

	<select id="read2" parameterType="String" resultType="OrdersDTO">
		select m_id from member where m_id = #{m_id}
	</select>
	<update id="update2" parameterType="Map">
		update member
		set m_mileage = m_mileage - (select mileage from mileage_info where
		member.m_grade = mileage_info.m_grade)
		+ ( select o_mileage from orders where order_num = #{order_num} ),
		m_ordercnt = m_ordercnt - 1
		where m_id = #{m_id}
	</update>
	<select id="sum" parameterType="String" resultType="Integer">
		select sum(o_pay)
		from orders where r_code = #{r_code}

	</select>
	<update id="milepay">
	update member
	set o_pay = o_pay - (select o_mileage from order where order_num = #{order_num})
	</update>
		<select id="rec" parameterType="String" resultType="OrdersDTO">
		select r_name from restaurant where orders.r_code = restaurant.r_code 
	</select>
	<select id="read3" parameterType="String" resultType="hashmap">
	select f_name,
      	   f_price
       from food
            where food_code = ${food_code}
	</select>
	 


</mapper>